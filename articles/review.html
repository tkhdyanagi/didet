<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="didet">
<title>Review of An Effective Treatment Approach to Difference-in-Differences with General Treatment Patterns • didet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Review of An Effective Treatment Approach to Difference-in-Differences with General Treatment Patterns">
<meta property="og:description" content="didet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">didet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/didet.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/review.html">Review of An Effective Treatment Approach to Difference-in-Differences with General Treatment Patterns</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Review of An Effective Treatment Approach to Difference-in-Differences with General Treatment Patterns</h1>
                        <h4 data-toc-skip class="author">Takahide Yanagi
(<a href="mailto:yanagi@econ.kyoto-u.ac.jp" class="email">yanagi@econ.kyoto-u.ac.jp</a>)</h4>
            
      
      
      <div class="d-none name"><code>review.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette briefly reviews <a href="https://doi.org/10.48550/arXiv.2212.13226" class="external-link">Yanagi (2023) “An
effective treatment approach to difference-in-differences with general
treatment patterns”</a>.</p>
</div>
<div class="section level2">
<h2 id="setting">Setting<a class="anchor" aria-label="anchor" href="#setting"></a>
</h2>
<p>We have balanced panel data <span class="math inline">\(\{ (Y_{it},
D_{it}, X_i): i = 1, \dots, N; t = 1, \dots, T \}\)</span>, where</p>
<ul>
<li>
<span class="math inline">\(Y_{it}\)</span>: An outcome variable for
unit <span class="math inline">\(i\)</span> in period <span class="math inline">\(t\)</span>.</li>
<li>
<span class="math inline">\(D_{it}\)</span>: A possibly non-binary
time-varying treatment variable for unit <span class="math inline">\(i\)</span> in period <span class="math inline">\(t\)</span>.</li>
<li>
<span class="math inline">\(X_i\)</span>: A unit <span class="math inline">\(i\)</span> specific covariate vector.</li>
</ul>
<p>Suppose that <span class="math inline">\(D_{it} = 0\)</span>
indicates that unit <span class="math inline">\(i\)</span> is a
comparison unit in period <span class="math inline">\(t\)</span>.</p>
<p>The goal is to assess the instantaneous and dynamic effects of the
treatment receipt on the outcome. With general treatment patterns, there
may be many treatment paths, and it is generally difficult to estimate
treatment parameters defined with the potential outcome given the entire
path of treatment adoption. To circumvent this problem, <a href="https://doi.org/10.48550/arXiv.2212.13226" class="external-link">Yanagi (2023)</a>
proposes an <em>effective treatment</em> approach to DiD estimation.</p>
</div>
<div class="section level2">
<h2 id="effective-treatment">Effective Treatment<a class="anchor" aria-label="anchor" href="#effective-treatment"></a>
</h2>
<p>For each <span class="math inline">\(i\)</span> and <span class="math inline">\(t\)</span>, let <span class="math inline">\(\mathbf{D}_{it} = (D_{i1}, \dots, D_{it})\)</span>
denote the <span class="math inline">\(t\)</span>-dimensional vector of
treatment adoptions for unit <span class="math inline">\(i\)</span>.</p>
<p>The <em>effective treatment function</em> converts the entire
treatment path <span class="math inline">\(\mathbf{D}_{iT}\)</span> into
an empirically tractable low-dimensional variable <span class="math inline">\(E_{it}\)</span> that researchers believe to be
relevant to the outcome in period <span class="math inline">\(t\)</span>. Specifically, consider the
<em>realized effective treatment</em> <span class="math inline">\(E_{it}
= E_t(\mathbf{D}_{iT})\)</span> with a user-specified function <span class="math inline">\(E_t\)</span>. Suppose that <span class="math inline">\(E_{it} = 0\)</span> indicates that unit <span class="math inline">\(i\)</span> is a comparison unit in period <span class="math inline">\(t\)</span> under the chosen effective treatment
<span class="math inline">\(E_t\)</span>. We call nonzero realizations
of <span class="math inline">\(E_{it}\)</span> <em>effective treatment
intensity</em>.</p>
<p>For example, we consider the following specifications useful for
understanding the instantaneous and dynamic treatment effects:</p>
<ul>
<li>The <em>once</em> specification: <span class="math display">\[\begin{align*}
E_{it}^{\mathrm{O}} = \mathbf{1}\{ \mathbf{D}_{it} \neq 0 \},
\end{align*}\]</span> indicating whether unit <span class="math inline">\(i\)</span> has received some treatment intensity
at least <em>once</em> so far.</li>
<li>The <em>event</em> specification: <span class="math display">\[\begin{align*}
E_{it}^{\mathrm{E}} =
      \begin{cases}
          \min \{ s \le t : D_{is} \neq 0 \} &amp; \text{if
$\mathbf{D}_{it} \neq 0$} \\
          0 &amp;  \text{otherwise}
      \end{cases}
\end{align*}\]</span> This is the time period so far in which unit <span class="math inline">\(i\)</span> is first treated, that is, the
so-called <em>event</em> date.</li>
<li>The <em>number</em> specification: <span class="math display">\[\begin{align*}
E_{it}^{\mathrm{N}} = \sum_{s=1}^t \mathbf{1}\{ D_{is} \neq 0 \},
\end{align*}\]</span> which is the <em>number</em> of treatment
adoptions so far.</li>
</ul>
<p>Let <span class="math inline">\(E_{it}^*\)</span> denote the “true”
effective treatment specification. Then, the potential outcome for unit
<span class="math inline">\(i\)</span> in period <span class="math inline">\(t\)</span> given <span class="math inline">\(E_{it}^* = e^*\)</span> is well defined, which is
denoted as <span class="math inline">\(Y_{it}^*(e^*)\)</span>. By
construction, <span class="math inline">\(Y_{it} =
Y_{it}^*(E_{it}^*)\)</span>.</p>
</div>
<div class="section level2">
<h2 id="target-parameter">Target Parameter<a class="anchor" aria-label="anchor" href="#target-parameter"></a>
</h2>
<p>Given a user-specified effective treatment specification <span class="math inline">\(E_t\)</span>, the parameter of interest is the
average treatment effect for movers (ATEM). For two time periods <span class="math inline">\(1 \le s &lt; t\)</span> and effective treatment
intensity <span class="math inline">\(e \neq 0\)</span>, the ATEM is
defined by <span class="math display">\[\begin{align*}
  \mathrm{ATEM}(t, s, e) = \mathbb{E}[ Y_{it} - Y_{it}^*(0) \mid
M_{i,t,s,e} = 1 ],  
\end{align*}\]</span> where <span class="math inline">\(M_{i,t,s,e} =
\mathbf{1}\{ E_{it} = e, E_{is} = 0 \}\)</span> indicates a
<em>mover</em> who moves from the comparison group (<span class="math inline">\(E_{is} = 0\)</span>) to receiving effective
treatment intensity <span class="math inline">\(e\)</span> (<span class="math inline">\(E_{it} = e\)</span>) between periods <span class="math inline">\(s\)</span> and <span class="math inline">\(t\)</span>.</p>
<p><a href="https://doi.org/10.48550/arXiv.2212.13226" class="external-link">Yanagi (2023)</a>
shows that the causal interpretation of the ATEM parameter depends on
the relationship between the pre-specified <span class="math inline">\(E_t\)</span> and true <span class="math inline">\(E_t^*\)</span>. Importantly, the ATEM has
meaningful causal interpretation even when the pre-specified <span class="math inline">\(E_t\)</span> is “incorrect” in the sense that the
potential outcome given <span class="math inline">\(E_t\)</span> is not
well defined.</p>
<p>The choice of <span class="math inline">\((t, s, e)\)</span> depends
on the specification of effective treatment:</p>
<ul>
<li>The <em>once</em> specification: Let <span class="math inline">\(\mathrm{ATEM}^{\mathrm{O}}(t, s, 1) = \mathbb{E} [
Y_{it} - Y_{it}^*(0) \mid M_{i,t,s,1}^{\mathrm{O}} = 1 ]\)</span>, where
<span class="math inline">\(M_{i,t,s,1}^{\mathrm{O}} = \mathbf{1}\{
E_{it}^{\mathrm{O}} = 1, E_{is}^{\mathrm{O}} = 0 \}\)</span>. By setting
<span class="math inline">\(s = 1\)</span>, we obtain <span class="math display">\[\begin{align*}
  \mathrm{ATEM}^{\mathrm{O}}(t, 1, 1)
  = \mathbb{E} [ Y_{it} - Y_{it}^*(0) \mid D_{i1} = 0, \mathbf{D}_{it}
\neq 0 ],
\end{align*}\]</span> which captures the composition of the
instantaneous and dynamic treatment effects, that is, the effect of
receiving some treatment intensity at least once between periods <span class="math inline">\(2\)</span> and <span class="math inline">\(t\)</span> for those who did not receive the
treatment in the first period.</li>
<li>The <em>event</em> specification: Let <span class="math inline">\(\mathrm{ATEM}^{\mathrm{E}}(t, s, e) = \mathbb{E} [
Y_{it} - Y_{it}^*(0) \mid M_{i,t,s,e}^{\mathrm{E}} = 1 ]\)</span>, where
<span class="math inline">\(M_{i,t,s,e}^{\mathrm{E}} = \mathbf{1}\{
E_{it}^{\mathrm{E}} = e, E_{is}^{\mathrm{E}} = 0 \}\)</span> with <span class="math inline">\(e \ge 2\)</span> and <span class="math inline">\(t
\ge e\)</span>. Setting <span class="math inline">\(s = e - 1\)</span>,
we can see that <span class="math display">\[\begin{align*}
  \mathrm{ATEM}^{\mathrm{E}}(t, e-1, e)
  = \mathbb{E} \left[ Y_{it} - Y_{it}^*(0) \mid \mathbf{D}_{i,e-1} = 0,
D_{ie} \neq 0 \right].
\end{align*}\]</span> This indicates the ATE in period <span class="math inline">\(t\)</span> for those who first received some
treatment intensity in period <span class="math inline">\(e\)</span>.
Estimating this ATEM over a set of <span class="math inline">\((t,
e)\)</span> enables us to understand the instantaneous and dynamic
treatment effects separately. Specifically, <span class="math inline">\(\mathrm{ATEM}^{\mathrm{E}}(t, e-1, e)\)</span>
with <span class="math inline">\(t = e\)</span> (resp. with <span class="math inline">\(t &gt; e\)</span>) is informative about the
instantaneous (resp. dynamic) effect of the first treatment received in
period <span class="math inline">\(e\)</span>.</li>
<li>The <em>number</em> specification: Define <span class="math inline">\(\mathrm{ATEM}^{\mathrm{N}}(t, s, e) = \mathbb{E} [
Y_{it} - Y_{it}^*(0) \mid M_{i,t,s,e}^{\mathrm{N}} = 1 ]\)</span>, where
<span class="math inline">\(M_{i,t,s,e}^{\mathrm{N}} = \mathbf{1}\{
E_{it}^{\mathrm{N}} = e, E_{is}^{\mathrm{N}} = 0 \}\)</span> with <span class="math inline">\(e \ge 1\)</span> and <span class="math inline">\(t
\ge e + 1\)</span>. When we set <span class="math inline">\(s =
1\)</span>, the ATEM reduces to <span class="math display">\[\begin{align*}
  \mathrm{ATEM}^{\mathrm{N}}(t, 1, e)
  = \mathbb{E} \left[ Y_{it} - Y_{it}^*(0) \; \middle| \; D_{i1} = 0,
\sum_{r=2}^t \mathbf{1}\{ D_{ir} \neq 0 \} = e \right].
\end{align*}\]</span> The ATEM in this case recovers the ATE in period
<span class="math inline">\(t\)</span> for those who were not treated in
the first period and received treatment <span class="math inline">\(e\)</span> times in <span class="math inline">\(t\)</span> periods. By estimating this ATEM over a
set of <span class="math inline">\((t, e)\)</span>, we can separately
assess the instantaneous and dynamic effects of the number of treatment
adoptions on the outcome.</li>
</ul>
</div>
<div class="section level2">
<h2 id="identification-estimation-and-statistical-inference-methods">Identification, Estimation, and Statistical Inference Methods<a class="anchor" aria-label="anchor" href="#identification-estimation-and-statistical-inference-methods"></a>
</h2>
<p><a href="https://doi.org/10.48550/arXiv.2212.13226" class="external-link">Yanagi (2023)</a>
builds on <a href="https://doi.org/10.1016/j.jeconom.2020.12.001" class="external-link">Callaway and
Sant’Anna (2021)</a> and develops doubly robust identification,
estimation, and bootstrap inference methods for the ATEM parameter under
a conditional parallel trends assumption. See the paper for more
details.</p>
<p>For estimation, the <code><a href="../reference/didet.html">didet()</a></code> function internally calls
the <code>drdid_panel()</code> function from the <strong>DRDID</strong>
package (<a href="https://doi.org/10.1016/j.jeconom.2020.06.003" class="external-link">Sant’Anna and Zhao,
2020</a>). More precisely, in the first-step estimation, the outcome
regression function and generalized propensity score are estimated by
the ordinary least squares and maximum likelihood (Logit),
respectively.</p>
</div>
<div class="section level2">
<h2 id="pre-trends-test">Pre-trends Test<a class="anchor" aria-label="anchor" href="#pre-trends-test"></a>
</h2>
<p>Similar to the staggered adoption case, we can assess the validity of
parallel trends by checking “pre-trends”. To be specific, for three time
periods <span class="math inline">\(t &gt; s \ge r\)</span> and
effective treatment intensity <span class="math inline">\(e \neq
0\)</span>, define <span class="math display">\[\begin{align*}
  \mathrm{ATEM}(t, s, r, e) = \mathbb{E}[ Y_{ir} - Y_{ir}^*(0) \mid
M_{i,t,s,e} = 1 ].
\end{align*}\]</span> We can show that <span class="math inline">\(\mathrm{ATEM}(t, s, r, e) = 0\)</span> under the
parallel trends assumption. Thus, the parallel trends assumption would
be implausible if we find statistical evidence against <span class="math inline">\(\mathrm{ATEM}(t, s, r, e) = 0\)</span>.</p>
</div>
<div class="section level2">
<h2 id="practical-recommendation">Practical Recommendation<a class="anchor" aria-label="anchor" href="#practical-recommendation"></a>
</h2>
<p>It is common practice to perform event study analyses prior to formal
DiD estimation. Thus, it would be natural to take the <em>event</em>
specification as a good starting point and to plot <span class="math inline">\(\mathrm{ATEM}^{\mathrm{E}}(t, e-1, e)\)</span>
over a set of <span class="math inline">\((t, e)\)</span>, including
``pre-trends’’ to assess the validity of parallel trends. Then, it would
be desirable to further examine the treatment effect heterogeneity by
trying the <em>number</em> specification. Finally, to obtain more
precise estimates, it would be recommended to estimate the ATEM
parameter defined with the <em>once</em> specification and its
time-series average as useful aggregation parameters, that is, <span class="math display">\[\begin{align*}
    \mathrm{ATEM}^{\mathrm{A}}
    = \frac{1}{(T - 1)} \sum_{t=2}^T \mathrm{ATEM}^{\mathrm{O}}(t, 1,
1).
\end{align*}\]</span></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Callaway, B., and Sant’Anna, P. HC, 2021. Difference-in-differences
with multiple time periods. Journal of Econometrics 225(2), 200-230. <a href="https://doi.org/10.1016/j.jeconom.2020.12.001" class="external-link">Link</a>
</li>
<li>Sant’Anna, P. HC, and Zhao, J, 2020. Doubly robust
difference-in-differences estimators. Journal of Econometrics, 219(1),
101-122. <a href="https://doi.org/10.1016/j.jeconom.2020.06.003" class="external-link">Link</a>
</li>
<li>Yanagi, T., 2023. An effective treatment approach to
difference-in-differences with general treatment patterns. arXiv
preprint arXiv:2212.13226. <a href="https://doi.org/10.48550/arXiv.2212.13226" class="external-link">Link</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Takahide Yanagi.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
